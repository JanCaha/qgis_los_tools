name: Test plugin

on:
  push:
    paths:
    - "los_tools/**"
    - ".github/workflows/test_plugin.yaml"

jobs:
  my_job:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          path: '/__w/qgis_los_tools/qgis_los_tools/'

      - name: print dir
        run: |
          cd /__w/qgis_los_tools/qgis_los_tools/
          dir

      - name: Install QGIS
        run: |
          wget -qO - https://qgis.org/downloads/qgis-2020.gpg.key | sudo gpg --no-default-keyring --keyring gnupg-ring:/etc/apt/trusted.gpg.d/qgis-archive.gpg --import || true
          sudo chmod a+r /etc/apt/trusted.gpg.d/qgis-archive.gpg
          sudo add-apt-repository "deb https://qgis.org/ubuntu-nightly `lsb_release -c -s` main"
          sudo apt-get update
          sudo apt-get install -y qgis qgis-plugin-grass saga

      - name: print env
        run: |
          export PYTHONPATH=/__w/qgis_los_tools/qgis_los_tools:$PYTHONPATH
          printenv

      - run: |
          python3 /__w/qgis_los_tools/qgis_los_tools/los_tools/package_test_suite.py
